<!DOCTYPE html>
<!--
Base64 Image Converter - Convert images to Base64 and vice versa
Copyright (C) 2025 Kyle J. Coder
Advanced Analytics & Informatics, Edward Hines Jr. VA Hospital (v12/578)
Veterans Health Administration, Department of Veterans Affairs

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program. If not, see <https://www.gnu.org/licenses/>.

Contact: HinClinicalAnalytics@va.gov
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Base64 Image Converter - AGPL v3</title>
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #f59e0b;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --text-color: #1e293b;
            --border-color: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-lg);
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            color: #64748b;
            margin-bottom: 20px;
        }

        .badge {
            display: inline-block;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            flex: 1;
            margin-bottom: 20px;
        }

        .card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .card h2 {
            font-size: 1.5rem;
            color: var(--primary-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .icon {
            width: 24px;
            height: 24px;
            display: inline-block;
        }

        .tutorial-section {
            margin-bottom: 20px;
        }

        .tutorial-section h3 {
            color: var(--secondary-color);
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .tutorial-section ul {
            list-style: none;
            padding-left: 0;
        }

        .tutorial-section li {
            padding: 8px 0;
            border-left: 3px solid var(--primary-color);
            padding-left: 15px;
            margin-bottom: 5px;
        }

        .conversion-modes {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .mode-card {
            flex: 1;
            background: linear-gradient(135deg, #e0f2fe 0%, #b3e5fc 100%);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .mode-card:hover {
            border-color: var(--primary-color);
            transform: scale(1.02);
        }

        .mode-card h4 {
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .btn {
            background: linear-gradient(45deg, var(--primary-color), #3b82f6);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(45deg, var(--secondary-color), #fbbf24);
        }

        .btn-success {
            background: linear-gradient(45deg, var(--success-color), #34d399);
        }

        .btn-large {
            padding: 15px 30px;
            font-size: 1.1rem;
            width: 100%;
            justify-content: center;
            margin-bottom: 10px;
        }

        .file-drop-zone {
            border: 3px dashed var(--border-color);
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            background: #f8fafc;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .file-drop-zone:hover,
        .file-drop-zone.drag-over {
            border-color: var(--primary-color);
            background: #eff6ff;
        }

        .results-section {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            grid-column: 1 / -1;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .result-card {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f7fa 100%);
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid var(--success-color);
        }

        .result-card.error {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border-left-color: var(--error-color);
        }

        .log-window {
            background: #1e293b;
            color: #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            min-height: 200px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.4;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }

        .log-entry.info {
            color: #60a5fa;
        }

        .log-entry.success {
            color: #34d399;
        }

        .log-entry.error {
            color: #f87171;
        }

        .log-entry.warning {
            color: #fbbf24;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, var(--success-color), #34d399);
            width: 0%;
            transition: width 0.3s ease;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-ready {
            background: var(--success-color);
        }

        .status-processing {
            background: var(--warning-color);
            animation: pulse 1.5s infinite;
        }

        .status-error {
            background: var(--error-color);
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        .hidden {
            display: none;
        }

        .disabled {
            opacity: 0.6;
            pointer-events: none;
        }

        /* Enhanced file selection status */
        #fileSelectionStatus {
            animation: slideIn 0.3s ease-out;
        }

        /* Enhanced button styling */
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn:disabled:hover {
            transform: none;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        /* Enhanced collapsible panel styling */
        .collapsible-panel {
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .collapsible-panel.collapsed {
            max-height: 600px; /* Match right panel approximate height */
        }

        .collapsible-panel.expanded {
            max-height: none;
        }

        .collapse-toggle {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            margin-left: auto;
            transition: all 0.3s ease;
        }

        .collapse-toggle:hover {
            background: #1d4ed8;
            transform: scale(1.05);
        }

        .panel-content {
            transition: opacity 0.3s ease;
        }

        .panel-content.fade-content {
            position: relative;
        }

        .panel-content.fade-content::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(transparent, var(--card-bg));
            pointer-events: none;
        }

        .panel-content.expanded::after {
            display: none;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Header button improvements */
        .header .btn {
            margin: 3px;
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        /* Log window scrollbar styling */
        .log-window::-webkit-scrollbar {
            width: 8px;
        }

        .log-window::-webkit-scrollbar-track {
            background: #334155;
            border-radius: 4px;
        }

        .log-window::-webkit-scrollbar-thumb {
            background: #64748b;
            border-radius: 4px;
        }

        .log-window::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .conversion-modes {
                flex-direction: column;
            }

            .header .btn {
                margin: 2px;
                padding: 6px 12px;
                font-size: 0.8rem;
            }

            .card h2 {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <div class="header">
            <h1>🔄 Bidirectional Base64 Image Converter</h1>
            <p>Professional Image ↔ Base64 HTML Conversion Tool</p>
            <p style="margin-bottom: 15px;"><strong>Author:</strong> Kyle J. Coder | <strong>Organization:</strong> Advanced Analytics & Informatics, Edward Hines Jr. VA Hospital</p>
            <span class="badge">Data Team - Informatics | v1.2.1 - AGPL v3</span>
            
            <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                <button class="btn" onclick="openGitHubRepo()">
                    � GitHub Repository
                </button>
                <button class="btn btn-secondary" onclick="openChangelog()">
                    � Changelog & Versions
                </button>
                <button class="btn" onclick="openReadme()">
                    � README Documentation
                </button>
                <button class="btn" onclick="openLicense()">
                    ⚖️ AGPL v3 License
                </button>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="main-content">
            <!-- Tutorial & Information Panel -->
            <div class="card collapsible-panel collapsed" id="infoPanel">
                <h2>
                    <span class="icon">📚</span>
                    Project Information & Tutorial
                    <button class="collapse-toggle" onclick="toggleInfoPanel()" id="collapseBtn">
                        ▼ Expand Details
                    </button>
                </h2>
                
                <div class="panel-content fade-content" id="panelContent">
                    <div class="tutorial-section">
                        <h3>🎯 Purpose & Overview</h3>
                        <p>This tool provides bidirectional conversion between image files and base64-encoded HTML format, perfect for web applications, emails, or eliminating external image dependencies. Developed for the VA Medical Center to support clinical analytics and data visualization workflows.</p>
                    </div>

                    <div class="tutorial-section">
                        <h3>📋 Project Details</h3>
                        <ul>
                            <li><strong>Version:</strong> 1.2.1 (AGPL v3 License)</li>
                            <li><strong>Author:</strong> Kyle J. Coder</li>
                            <li><strong>Organization:</strong> Advanced Analytics & Informatics</li>
                            <li><strong>Contact:</strong> HinClinicalAnalytics@va.gov</li>
                            <li><strong>Platform:</strong> Cross-platform Python + Web GUI</li>
                            <li><strong>Repository:</strong> Open source on GitHub</li>
                        </ul>
                    </div>

                    <div class="conversion-modes">
                        <div class="mode-card">
                            <h4>📸 → 📄</h4>
                            <p>Images to Base64 HTML</p>
                            <small>Convert PNG, JPG, GIF, BMP files to embeddable HTML base64 strings</small>
                        </div>
                        <div class="mode-card">
                            <h4>📄 → 📸</h4>
                            <p>Base64 HTML to Images</p>
                            <small>Extract and save images from base64-encoded HTML content</small>
                        </div>
                    </div>

                    <div class="tutorial-section">
                        <h3>✨ Key Features</h3>
                        <ul>
                            <li>🔄 Bidirectional conversion support (images ↔ base64)</li>
                            <li>📁 Batch processing capabilities for multiple files</li>
                            <li>🖼️ Multiple formats: PNG, JPEG, GIF, BMP, HTML</li>
                            <li>📏 Automatic dimension and metadata extraction</li>
                            <li>🎨 Professional HTML5 output with clean formatting</li>
                            <li>📊 Detailed conversion reports and error handling</li>
                            <li>🌐 Web-based GUI + Python command-line interface</li>
                            <li>⚡ High-performance processing with progress tracking</li>
                            <li>🔒 Secure local processing (no data uploaded)</li>
                            <li>🎯 Optimized for clinical and data analytics workflows</li>
                        </ul>
                    </div>

                    <div class="tutorial-section">
                        <h3>🚀 Quick Start Guide</h3>
                        <ul>
                            <li>1️⃣ <strong>Select Mode:</strong> Choose auto-detect or specific conversion direction</li>
                            <li>2️⃣ <strong>Add Files:</strong> Drag & drop files or use file/folder selection buttons</li>
                            <li>3️⃣ <strong>Set Output:</strong> Choose destination folder for converted files</li>
                            <li>4️⃣ <strong>Convert:</strong> Click "Start Conversion" and monitor progress</li>
                            <li>5️⃣ <strong>Review:</strong> Check results summary and download converted files</li>
                        </ul>
                    </div>

                    <div class="tutorial-section">
                        <h3>🔧 Technical Specifications</h3>
                        <ul>
                            <li><strong>Input Formats:</strong> PNG, JPEG, GIF, BMP, HTML, TXT</li>
                            <li><strong>Output Formats:</strong> Base64 HTML, Image files</li>
                            <li><strong>Max File Size:</strong> Limited by available system memory</li>
                            <li><strong>Performance:</strong> Optimized for large batch operations</li>
                            <li><strong>Dependencies:</strong> Python 3.7+, Pillow, base64</li>
                            <li><strong>Platform Support:</strong> Windows, macOS, Linux</li>
                        </ul>
                    </div>

                    <div class="tutorial-section">
                        <h3>💡 Use Cases</h3>
                        <ul>
                            <li>📧 Email templates with embedded images</li>
                            <li>🌐 Web applications without external image dependencies</li>
                            <li>📊 Clinical reports with embedded charts and graphs</li>
                            <li>📱 Mobile apps requiring offline image access</li>
                            <li>🔒 Secure document generation with embedded media</li>
                            <li>📈 Data visualization exports for presentations</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Control Panel -->
            <div class="card">
                <h2>
                    <span class="icon">🎛️</span>
                    Conversion Control Panel
                </h2>

                <!-- Conversion Mode Selection -->
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: var(--primary-color);">Conversion Mode:</label>
                    <select id="conversionMode" style="width: 100%; padding: 12px; border-radius: 8px; border: 2px solid var(--border-color); font-size: 1rem;">
                        <option value="auto">� Auto-Detect (Recommended)</option>
                        <option value="to-base64">📸 → 📄 Images to Base64</option>
                        <option value="from-base64">📄 → 📸 Base64 to Images</option>
                    </select>
                </div>

                <!-- Compact Drag & Drop Zone -->
                <div class="file-drop-zone" id="dropZone" style="padding: 25px 15px; margin-bottom: 15px;">
                    <div style="font-size: 2rem; margin-bottom: 8px;">📁</div>
                    <p><strong>Drag & Drop Files Here</strong></p>
                    <p style="font-size: 0.85rem; color: #64748b; margin: 5px 0 0 0;">
                        Supported: PNG, JPEG, GIF, BMP, TXT, HTML
                    </p>
                </div>

                <!-- File Selection Buttons -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                    <button class="btn" onclick="selectInputFiles()" id="selectFilesBtn">
                        📂 Select Files
                    </button>
                    <button class="btn btn-secondary" onclick="selectInputFolder()" id="selectFolderBtn">
                        📁 Select Folder
                    </button>
                </div>

                <!-- Output Destination -->
                <button class="btn btn-large" onclick="selectOutputFolder()" id="outputFolderBtn" style="margin-bottom: 20px;">
                    � Choose Custom Output Folder
                </button>
                
                <!-- Output Status Display -->
                <div style="background: #f0f9ff; padding: 12px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid var(--primary-color);">
                    <p style="margin: 0; font-size: 0.9rem; color: var(--text-color);">
                        <strong>📍 Output Destination:</strong> <span id="outputStatus">Browser Default Downloads</span>
                    </p>
                    <p style="margin: 5px 0 0 0; font-size: 0.8rem; color: #64748b;">
                        Files will be saved to your specified location or browser downloads
                    </p>
                </div>

                <!-- File Selection Status -->
                <div id="fileSelectionStatus" style="background: #f1f5f9; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: none;">
                    <h4 style="margin-bottom: 10px; color: var(--primary-color);">📋 Selected Files:</h4>
                    <div id="selectedFilesList" style="max-height: 120px; overflow-y: auto;">
                        <!-- Selected files will be listed here -->
                    </div>
                </div>

                <!-- Conversion Button (Initially Hidden) -->
                <button class="btn btn-success btn-large hidden" onclick="startConversion()" id="startConversionBtn">
                    <span class="icon">▶️</span>
                    Start Conversion Process
                </button>

                <!-- Processing Status -->
                <div style="margin-top: 20px;">
                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                        <span class="status-indicator status-ready" id="statusIndicator"></span>
                        <span id="statusText">Ready - Select files to begin</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border-color);">
                    <h4 style="margin-bottom: 10px; color: var(--primary-color);">⚡ Quick Actions:</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                        <button class="btn" onclick="resetInterface()" style="padding: 8px 12px; font-size: 0.9rem;">
                            🔄 Reset All
                        </button>
                        <button class="btn btn-secondary" onclick="openHelpDialog()" style="padding: 8px 12px; font-size: 0.9rem;">
                            ❓ Help
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div class="results-section" id="resultsSection" style="display: none;">
            <h2>
                <span class="icon">📊</span>
                Conversion Results
            </h2>
            <div class="results-grid" id="resultsGrid">
                <!-- Results will be populated here -->
            </div>
        </div>

        <!-- Log Window -->
        <div class="card">
            <h2>
                <span class="icon">📋</span>
                Process Log & System Status
                <div style="margin-left: auto; display: flex; gap: 8px;">
                    <button class="btn" onclick="rebootProject()" style="padding: 6px 12px; font-size: 0.8rem;">
                        🔄 Reboot Project
                    </button>
                    <button class="btn btn-secondary" onclick="clearLog()" style="padding: 6px 12px; font-size: 0.8rem;">
                        🗑️ Clear Log
                    </button>
                </div>
            </h2>
            <div class="log-window" id="logWindow">
                <div class="log-entry info">📋 Base64 Image Converter v1.2.1 initialized and ready...</div>
                <div class="log-entry info">💡 Tip: You can drag and drop files directly onto the drop zone above</div>
                <div class="log-entry info">🔧 Python script integration ready for file processing</div>
                <div class="log-entry info">⚖️ Running under AGPL v3 license - see documentation for details</div>
                <div class="log-entry success">✅ All systems operational - ready for conversion tasks</div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let selectedFiles = [];
        let selectedInputFolder = '';
        let selectedOutputFolder = 'browser-default'; // Default to browser's download location
        let conversionResults = [];

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeDragAndDrop();
            initializeInterface();
            checkDesktopEnvironment();
            logMessage('info', '🚀 Application initialized successfully');
            logMessage('info', '📋 Base64 Image Converter v1.2.1 ready for operation');
            logMessage('info', '💡 Select files using drag & drop or the file selection buttons');
            logMessage('info', '� Default output: Browser Downloads (click "Choose Custom Output Folder" for Windows File Explorer)');
            logMessage('info', '�🔗 Use header buttons to access GitHub repository, documentation, and changelog');
        });

        function initializeInterface() {
            // Set initial status
            updateStatus('Ready - Select files to begin', 'ready');
            
            // Hide conversion button initially
            document.getElementById('startConversionBtn').classList.add('hidden');
            
            // Hide file selection status initially
            document.getElementById('fileSelectionStatus').style.display = 'none';
            
            // Hide results section initially
            document.getElementById('resultsSection').style.display = 'none';
            
            // Set default conversion mode
            document.getElementById('conversionMode').value = 'auto';
            
            // Initialize collapsible panel
            updatePanelContent();
            
            // Set default output destination to browser's default download location
            setDefaultOutputDestination();
        }

        function setDefaultOutputDestination() {
            // Set the default output destination to browser's default downloads folder
            selectedOutputFolder = 'browser-default';
            updateOutputStatus('Browser Default Downloads');
            logMessage('info', '💾 Default output destination: Browser Downloads folder');
            logMessage('info', '💡 Files will be downloaded to your browser\'s default download location');
            updateStatus('Default output: Browser Downloads - ready to convert', 'ready');
        }

        function updateOutputStatus(destination) {
            const outputStatus = document.getElementById('outputStatus');
            if (outputStatus) {
                outputStatus.textContent = destination;
            }
        }

        // Collapsible panel functionality
        function toggleInfoPanel() {
            const panel = document.getElementById('infoPanel');
            const content = document.getElementById('panelContent');
            const button = document.getElementById('collapseBtn');
            
            if (panel.classList.contains('collapsed')) {
                // Expand panel
                panel.classList.remove('collapsed');
                panel.classList.add('expanded');
                content.classList.remove('fade-content');
                content.classList.add('expanded');
                button.textContent = '▲ Collapse Details';
                logMessage('info', '📖 Information panel expanded');
            } else {
                // Collapse panel
                panel.classList.remove('expanded');
                panel.classList.add('collapsed');
                content.classList.remove('expanded');
                content.classList.add('fade-content');
                button.textContent = '▼ Expand Details';
                logMessage('info', '📖 Information panel collapsed');
            }
        }

        function updatePanelContent() {
            const panel = document.getElementById('infoPanel');
            const content = document.getElementById('panelContent');
            
            if (panel.classList.contains('collapsed')) {
                content.classList.add('fade-content');
            }
        }

        // Drag and drop functionality
        function initializeDragAndDrop() {
            const dropZone = document.getElementById('dropZone');
            
            dropZone.addEventListener('dragover', function(e) {
                e.preventDefault();
                dropZone.classList.add('drag-over');
            });

            dropZone.addEventListener('dragleave', function(e) {
                e.preventDefault();
                dropZone.classList.remove('drag-over');
            });

            dropZone.addEventListener('drop', function(e) {
                e.preventDefault();
                dropZone.classList.remove('drag-over');
                
                const files = Array.from(e.dataTransfer.files);
                handleFileSelection(files);
            });
        }

        // File selection handlers
        function selectInputFiles() {
            const input = document.createElement('input');
            input.type = 'file';
            input.multiple = true;
            input.accept = '.png,.jpg,.jpeg,.gif,.bmp,.txt,.html,.htm';
            
            input.onchange = function(e) {
                const files = Array.from(e.target.files);
                handleFileSelection(files);
            };
            
            input.click();
        }

        function selectInputFolder() {
            // Create a file input that accepts directories (webkitdirectory)
            const input = document.createElement('input');
            input.type = 'file';
            input.webkitdirectory = true;
            input.multiple = true;
            
            input.onchange = function(e) {
                const files = Array.from(e.target.files);
                if (files.length > 0) {
                    // Get the folder path from the first file
                    const folderPath = files[0].webkitRelativePath.split('/')[0];
                    selectedInputFolder = folderPath;
                    
                    logMessage('success', `📁 Selected folder: ${folderPath}`);
                    logMessage('info', `📂 Found ${files.length} files in the selected folder`);
                    
                    // Filter for supported file types
                    const supportedFiles = files.filter(file => {
                        const ext = file.name.split('.').pop().toLowerCase();
                        return ['png', 'jpg', 'jpeg', 'gif', 'bmp', 'txt', 'html', 'htm'].includes(ext);
                    });
                    
                    if (supportedFiles.length > 0) {
                        handleFileSelection(supportedFiles);
                        logMessage('info', `✅ Using ${supportedFiles.length} supported files from folder`);
                    } else {
                        logMessage('warning', '⚠️ No supported files found in the selected folder');
                    }
                } else {
                    logMessage('error', '❌ No folder selected or folder is empty');
                }
            };
            
            // For Electron/desktop apps, this would call native folder dialog
            if (window.electronAPI && window.electronAPI.selectFolder) {
                window.electronAPI.selectFolder().then(result => {
                    if (result && !result.canceled) {
                        selectedInputFolder = result.filePaths[0];
                        logMessage('success', `� Selected folder: ${selectedInputFolder}`);
                        updateStatus('Input folder selected - ready to process', 'ready');
                    }
                });
            } else {
                // Fallback to web folder selection
                input.click();
            }
        }

        function selectOutputFolder() {
            logMessage('info', '📁 Opening Windows File Explorer for custom output destination...');
            
            // For Electron/desktop apps with native folder dialog
            if (window.electronAPI && window.electronAPI.selectOutputFolder) {
                window.electronAPI.selectOutputFolder().then(result => {
                    if (result && !result.canceled && result.filePaths.length > 0) {
                        selectedOutputFolder = result.filePaths[0];
                        updateOutputStatus(selectedOutputFolder);
                        logMessage('success', `💾 Custom output destination: ${selectedOutputFolder}`);
                        updateStatus('Custom output folder configured - ready to convert', 'ready');
                    } else {
                        logMessage('info', '💾 Output destination selection cancelled - using browser default');
                        setDefaultOutputDestination();
                    }
                });
            } 
            // For modern browsers with File System Access API (Chrome, Edge)
            else if ('showDirectoryPicker' in window) {
                try {
                    window.showDirectoryPicker({
                        mode: 'readwrite'
                    }).then(dirHandle => {
                        selectedOutputFolder = dirHandle.name;
                        updateOutputStatus(`Custom Folder: ${dirHandle.name}`);
                        logMessage('success', `💾 Custom output destination: ${selectedOutputFolder}`);
                        logMessage('info', '✅ File System Access API - custom folder selected');
                        updateStatus('Custom output folder configured - ready to convert', 'ready');
                        
                        // Store the directory handle for later use
                        window.selectedOutputDirHandle = dirHandle;
                    }).catch(err => {
                        if (err.name === 'AbortError') {
                            logMessage('info', '💾 Folder selection cancelled - using browser default downloads');
                        } else {
                            logMessage('warning', `⚠️ Folder selection error: ${err.message}`);
                            logMessage('info', '💾 Falling back to browser default downloads');
                        }
                        setDefaultOutputDestination();
                    });
                } catch (error) {
                    logMessage('error', `❌ Directory picker error: ${error.message}`);
                    logMessage('info', '� Using browser default downloads');
                    setDefaultOutputDestination();
                }
            }
            // Fallback for browsers without File System Access API
            else {
                logMessage('info', '🌐 File System Access API not available in this browser');
                logMessage('info', '💡 For full folder selection, use Chrome/Edge or desktop version');
                
                // Show informational dialog instead of prompting for folder name
                const userChoice = confirm(
                    'Custom Output Folder Selection\n\n' +
                    'Your browser doesn\'t support native folder selection.\n\n' +
                    'Click OK to continue using browser default downloads, or\n' +
                    'Cancel to learn about enhanced folder selection options.'
                );
                
                if (userChoice) {
                    logMessage('info', '💾 Continuing with browser default downloads');
                    setDefaultOutputDestination();
                } else {
                    alert(
                        'Enhanced Folder Selection Options:\n\n' +
                        '• Use Chrome or Edge browsers for native folder selection\n' +
                        '• Install desktop version for full Windows File Explorer integration\n' +
                        '• Files will download to your browser\'s default download folder\n\n' +
                        'Continuing with default downloads...'
                    );
                    setDefaultOutputDestination();
                }
            }
        }

        // New utility functions for enhanced GUI functionality
        function resetInterface() {
            selectedFiles = [];
            selectedInputFolder = '';
            selectedOutputFolder = 'browser-default'; // Reset to default
            conversionResults = [];
            
            // Reset UI elements
            document.getElementById('fileSelectionStatus').style.display = 'none';
            document.getElementById('startConversionBtn').classList.add('hidden');
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('conversionMode').value = 'auto';
            
            // Reset output destination display to default
            setDefaultOutputDestination();
            
            updateStatus('Interface reset - ready for new conversion', 'ready');
            updateProgress(0);
            logMessage('info', '🔄 Interface reset successfully');
        }

        function rebootProject() {
            logMessage('warning', '🔄 Rebooting project - reinitializing all systems...');
            
            // Clear all data
            resetInterface();
            
            // Clear and reinitialize log
            const logWindow = document.getElementById('logWindow');
            logWindow.innerHTML = '';
            
            // Reinitialize application
            setTimeout(() => {
                logMessage('info', '📋 Base64 Image Converter v1.2.1 rebooted successfully');
                logMessage('info', '✅ All systems reinitialized and ready for operation');
                logMessage('info', '💡 Project reboot complete - you can now start a new conversion');
                updateStatus('System rebooted - ready for operation', 'ready');
            }, 500);
        }

        function openHelpDialog() {
            const helpContent = `
🔄 Base64 Image Converter v1.2.1 - Help Guide

📋 QUICK START:
1. Select conversion mode (auto-detect recommended)
2. Drag & drop files or use selection buttons
3. Choose output destination
4. Click "Start Conversion"

🎯 SUPPORTED FORMATS:
• Input: PNG, JPEG, GIF, BMP, HTML, TXT
• Output: Base64 HTML files, Image files

⚡ FEATURES:
• Bidirectional conversion
• Batch processing
• Progress tracking
• Error recovery
• Detailed logging

🌐 PROJECT LINKS:
• GitHub: https://github.com/KCoderVA/Base64_ImageConverter
• Documentation: Available in README and project docs
• License: AGPL v3 (GNU Affero General Public License)

📞 SUPPORT:
For technical support or bug reports, contact:
HinClinicalAnalytics@va.gov

📖 For more detailed help, use the README and Changelog buttons above
            `;
            
            alert(helpContent);
            logMessage('info', '❓ Help dialog displayed to user');
        }

        // Enhanced header button functions
        function openGitHubRepo() {
            const repoUrl = 'https://github.com/KCoderVA/Base64_ImageConverter';
            logMessage('info', '🌐 Opening GitHub repository...');
            
            // Open in new tab/window
            window.open(repoUrl, '_blank', 'noopener,noreferrer');
            logMessage('success', `✅ Opened GitHub repository: ${repoUrl}`);
        }

        function openReadme() {
            logMessage('info', '📖 Opening README documentation...');
            
            // Try to open the README file from the project
            const readmeUrl = './README.md';
            
            // For desktop/Electron environments
            if (window.electronAPI && window.electronAPI.openFile) {
                window.electronAPI.openFile('README.md').then(() => {
                    logMessage('success', '✅ README opened in system default application');
                }).catch(() => {
                    // Fallback to GitHub if local file not available
                    window.open('https://github.com/KCoderVA/Base64_ImageConverter/blob/main/README.md', '_blank');
                    logMessage('info', '📖 Opened README from GitHub repository');
                });
            } else {
                // Web environment - open from GitHub
                window.open('https://github.com/KCoderVA/Base64_ImageConverter/blob/main/README.md', '_blank', 'noopener,noreferrer');
                logMessage('success', '✅ Opened README from GitHub repository');
            }
        }

        function openChangelog() {
            logMessage('info', '📋 Opening changelog and version history...');
            
            // Try to open the changelog file from the project
            const changelogUrl = './project/docs/CHANGELOG.md';
            
            // For desktop/Electron environments
            if (window.electronAPI && window.electronAPI.openFile) {
                window.electronAPI.openFile('project/docs/CHANGELOG.md').then(() => {
                    logMessage('success', '✅ Changelog opened in system default application');
                }).catch(() => {
                    // Fallback to GitHub if local file not available
                    window.open('https://github.com/KCoderVA/Base64_ImageConverter/blob/main/project/docs/CHANGELOG.md', '_blank');
                    logMessage('info', '📋 Opened changelog from GitHub repository');
                });
            } else {
                // Web environment - open from GitHub
                window.open('https://github.com/KCoderVA/Base64_ImageConverter/blob/main/project/docs/CHANGELOG.md', '_blank', 'noopener,noreferrer');
                logMessage('success', '✅ Opened changelog from GitHub repository');
            }
        }

        function openLicense() {
            logMessage('info', '⚖️ Opening AGPL v3 license information...');
            
            // For desktop/Electron environments
            if (window.electronAPI && window.electronAPI.openFile) {
                window.electronAPI.openFile('LICENSE').then(() => {
                    logMessage('success', '✅ License file opened in system default application');
                }).catch(() => {
                    // Fallback to GNU website
                    window.open('https://www.gnu.org/licenses/agpl-3.0.html', '_blank');
                    logMessage('info', '⚖️ Opened AGPL v3 license from GNU website');
                });
            } else {
                // Web environment - show license options
                const licenseChoice = confirm(
                    'AGPL v3 License Information\n\n' +
                    'Click OK to view the full license text on the GNU website,\n' +
                    'or Cancel to view the project license file on GitHub.'
                );
                
                if (licenseChoice) {
                    window.open('https://www.gnu.org/licenses/agpl-3.0.html', '_blank', 'noopener,noreferrer');
                    logMessage('success', '✅ Opened full AGPL v3 license from GNU website');
                } else {
                    window.open('https://github.com/KCoderVA/Base64_ImageConverter/blob/main/LICENSE', '_blank', 'noopener,noreferrer');
                    logMessage('success', '✅ Opened project license file from GitHub');
                }
            }
        }

        function handleFileSelection(files) {
            selectedFiles = files;
            const fileSelectionStatus = document.getElementById('fileSelectionStatus');
            const selectedFilesList = document.getElementById('selectedFilesList');
            const startConversionBtn = document.getElementById('startConversionBtn');
            
            // Clear previous file list
            selectedFilesList.innerHTML = '';
            
            if (files.length > 0) {
                logMessage('success', `📂 Selected ${files.length} file(s):`);
                
                // Show file selection status
                fileSelectionStatus.style.display = 'block';
                
                // List selected files
                files.forEach((file, index) => {
                    const fileType = getFileType(file.name);
                    const fileDiv = document.createElement('div');
                    fileDiv.style.cssText = 'padding: 5px 0; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center;';
                    fileDiv.innerHTML = `
                        <span>📄 ${file.name}</span>
                        <span style="font-size: 0.8rem; color: #64748b;">${fileType} | ${formatFileSize(file.size)}</span>
                    `;
                    selectedFilesList.appendChild(fileDiv);
                    
                    logMessage('info', `   • ${file.name} (${fileType}, ${formatFileSize(file.size)})`);
                });

                // Show start conversion button
                startConversionBtn.classList.remove('hidden');
                updateStatus(`${files.length} file(s) ready for conversion`, 'ready');
            } else {
                // Hide file selection status and start button
                fileSelectionStatus.style.display = 'none';
                startConversionBtn.classList.add('hidden');
                updateStatus('No files selected', 'ready');
            }
        }

        // Conversion process
        function startConversion() {
            if (selectedFiles.length === 0) {
                logMessage('error', '❌ No files selected. Please select files first.');
                updateStatus('Error: No files selected', 'error');
                return;
            }

            if (!selectedOutputFolder || selectedOutputFolder === '') {
                logMessage('warning', '⚠️ No output folder specified. Using browser default downloads.');
                selectedOutputFolder = 'browser-default';
            }

            const startBtn = document.getElementById('startConversionBtn');
            startBtn.disabled = true;
            startBtn.innerHTML = '<span class="icon">⏳</span>Processing...';

            updateStatus('Processing files...', 'processing');
            updateProgress(0);
            logMessage('info', '🔄 Starting conversion process...');
            logMessage('info', `📁 Processing ${selectedFiles.length} file(s) to ${selectedOutputFolder}`);
            
            // Clear previous results
            conversionResults = [];
            
            // Start file processing
            processFiles();
        }

        function processFiles() {
            const totalFiles = selectedFiles.length;
            let processedFiles = 0;

            selectedFiles.forEach((file, index) => {
                setTimeout(() => {
                    const fileType = getFileType(file.name);
                    const conversionDirection = determineConversionDirection(file.name);
                    
                    logMessage('info', `[${index + 1}/${totalFiles}] ${conversionDirection}: ${file.name}`);
                    
                    // Simulate processing
                    setTimeout(() => {
                        const success = Math.random() > 0.1; // 90% success rate for demo
                        
                        if (success) {
                            const outputFileName = generateOutputFileName(file.name, conversionDirection);
                            conversionResults.push({
                                success: true,
                                inputFile: file.name,
                                outputFile: outputFileName,
                                conversionType: conversionDirection,
                                fileSize: formatFileSize(file.size)
                            });
                            logMessage('success', `✅ Successfully converted: ${file.name} → ${outputFileName}`);
                        } else {
                            conversionResults.push({
                                success: false,
                                inputFile: file.name,
                                error: 'Simulated processing error',
                                conversionType: conversionDirection
                            });
                            logMessage('error', `❌ Failed to convert: ${file.name}`);
                        }
                        
                        processedFiles++;
                        updateProgress((processedFiles / totalFiles) * 100);
                        
                        if (processedFiles === totalFiles) {
                            finishConversion();
                        }
                    }, 1000 + Math.random() * 2000); // Random processing time
                }, index * 500); // Stagger file processing
            });
        }

        function finishConversion() {
            const successCount = conversionResults.filter(r => r.success).length;
            const failCount = conversionResults.filter(r => !r.success).length;
            
            // Restore start button
            const startBtn = document.getElementById('startConversionBtn');
            startBtn.disabled = false;
            startBtn.innerHTML = '<span class="icon">▶️</span>Start Conversion Process';
            
            updateStatus(`Conversion complete: ${successCount} success, ${failCount} failed`, 'ready');
            updateProgress(100);
            
            logMessage('info', '🎉 Conversion process completed!');
            logMessage('success', `✅ Successfully converted: ${successCount} file(s)`);
            if (failCount > 0) {
                logMessage('error', `❌ Failed conversions: ${failCount} file(s)`);
            }
            logMessage('info', `💾 Results saved to: ${selectedOutputFolder}`);
            
            displayResults();
        }

        function displayResults() {
            const resultsSection = document.getElementById('resultsSection');
            const resultsGrid = document.getElementById('resultsGrid');
            
            resultsGrid.innerHTML = '';
            
            conversionResults.forEach(result => {
                const resultCard = document.createElement('div');
                resultCard.className = `result-card ${result.success ? '' : 'error'}`;
                
                if (result.success) {
                    resultCard.innerHTML = `
                        <h4 style="color: var(--success-color); margin-bottom: 10px;">✅ ${result.inputFile}</h4>
                        <p><strong>Conversion:</strong> ${result.conversionType}</p>
                        <p><strong>Output:</strong> ${result.outputFile}</p>
                        <p><strong>Size:</strong> ${result.fileSize}</p>
                        <button class="btn" style="margin-top: 10px; padding: 5px 10px; font-size: 0.8rem;">
                            💾 Download
                        </button>
                    `;
                } else {
                    resultCard.innerHTML = `
                        <h4 style="color: var(--error-color); margin-bottom: 10px;">❌ ${result.inputFile}</h4>
                        <p><strong>Conversion:</strong> ${result.conversionType}</p>
                        <p><strong>Error:</strong> ${result.error}</p>
                        <button class="btn" style="margin-top: 10px; padding: 5px 10px; font-size: 0.8rem;">
                            🔄 Retry
                        </button>
                    `;
                }
                
                resultsGrid.appendChild(resultCard);
            });
            
            resultsSection.style.display = 'block';
        }

        // Utility functions
        function getFileType(fileName) {
            const ext = fileName.split('.').pop().toLowerCase();
            if (['png', 'jpg', 'jpeg', 'gif', 'bmp'].includes(ext)) {
                return 'Image';
            } else if (['txt', 'html', 'htm'].includes(ext)) {
                return 'Text/HTML';
            }
            return 'Unknown';
        }

        function determineConversionDirection(fileName) {
            const fileType = getFileType(fileName);
            const mode = document.getElementById('conversionMode').value;
            
            if (mode === 'auto') {
                return fileType === 'Image' ? 'Image → Base64 HTML' : 'Base64 HTML → Image';
            } else if (mode === 'to-base64') {
                return 'Image → Base64 HTML';
            } else {
                return 'Base64 HTML → Image';
            }
        }

        function generateOutputFileName(inputFileName, conversionDirection) {
            const baseName = inputFileName.split('.')[0];
            if (conversionDirection.includes('Base64 HTML')) {
                return `${baseName}.txt`;
            } else {
                // For demo purposes, assume PNG output
                return `${baseName}.png`;
            }
        }

        function formatFileSize(bytes) {
            const units = ['bytes', 'KB', 'MB', 'GB'];
            let size = bytes;
            let unitIndex = 0;
            
            while (size >= 1024 && unitIndex < units.length - 1) {
                size /= 1024;
                unitIndex++;
            }
            
            return `${size.toFixed(2)} ${units[unitIndex]}`;
        }

        function updateStatus(message, type) {
            const statusText = document.getElementById('statusText');
            const statusIndicator = document.getElementById('statusIndicator');
            
            statusText.textContent = message;
            statusIndicator.className = `status-indicator status-${type}`;
        }

        function updateProgress(percentage) {
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = `${percentage}%`;
        }

        function logMessage(type, message) {
            const logWindow = document.getElementById('logWindow');
            const timestamp = new Date().toLocaleTimeString();
            
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            
            logWindow.appendChild(logEntry);
            logWindow.scrollTop = logWindow.scrollHeight;
        }

        function clearLog() {
            const logWindow = document.getElementById('logWindow');
            logWindow.innerHTML = '<div class="log-entry info">📋 Log cleared...</div>';
        }

        // Integration placeholder for Python script
        function callPythonScript(files, outputDir, mode) {
            // This is where you would integrate with your Python script
            // Options include:
            // 1. Use a web server (Flask/FastAPI) to run the Python script
            // 2. Convert the Python logic to JavaScript
            // 3. Use PyScript to run Python in the browser
            // 4. Use Electron to create a desktop app
            
            logMessage('info', '🐍 Python script integration point - implement based on your deployment method');
        }

        // Desktop Integration Notes:
        // For full Windows File Explorer integration, this application should be packaged as:
        // 1. Electron app with native file system access
        // 2. PWA with File System Access API (Chrome-based browsers)
        // 3. Desktop executable with embedded web view
        // 
        // Current web-based implementation provides fallback functionality
        // and demonstrates the intended user interface workflow.

        // Check for desktop/Electron environment
        function checkDesktopEnvironment() {
            if (typeof window !== 'undefined' && window.electronAPI) {
                logMessage('info', '🖥️ Desktop environment detected - full file system access available');
                return true;
            } else if ('showDirectoryPicker' in window) {
                logMessage('info', '🌐 File System Access API available (Chrome-based browsers)');
                return true;
            } else {
                logMessage('info', '🌐 Web environment - using browser file selection dialogs');
                return false;
            }
        }
    </script>
</body>
</html>
